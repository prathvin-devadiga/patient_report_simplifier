<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Medical Report Simplifier | HACKAPHASIA 2025</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --dark-color: #2d3748;
            --light-gray: #f7fafc;
            --border-color: #e2e8f0;
            --text-muted: #718096;
            --success-color: #38a169;
            --warning-color: #d69e2e;
            --danger-color: #e53e3e;
            --shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background: var(--primary-gradient);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .hero-section {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 20px;
        }

        .hero-title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .hero-subtitle {
            font-size: clamp(1rem, 3vw, 1.3rem);
            opacity: 0.9;
            margin-bottom: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .sdg-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .sdg-badge {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .sdg-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .sdg-3 { background: #4c9f38; }
        .sdg-10 { background: #dd1367; }

        .main-card {
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .card-header {
            background: var(--success-gradient);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .card-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .card-header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .card-body {
            padding: 30px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark-color);
            font-size: 1.1rem;
        }

        .input-description {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        .text-area {
            width: 100%;
            min-height: 250px;
            padding: 20px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            font-size: 1rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            resize: vertical;
            transition: all 0.3s ease;
            background: var(--light-gray);
        }

        .text-area:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .text-area::placeholder {
            color: var(--text-muted);
            font-style: italic;
        }

        .example-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 10%, #4facfe 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            color: white;
        }

        .example-title {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .example-text {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            line-height: 1.8;
            backdrop-filter: blur(5px);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            min-width: 150px;
            justify-content: center;
        }

        .btn-primary {
            background: var(--success-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(56, 178, 172, 0.4);
        }

        .btn-secondary {
            background: var(--info-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            margin: 20px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid var(--border-color);
            border-top: 6px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-section {
            display: none;
            margin-top: 30px;
        }

        .health-score-card {
            background: var(--success-gradient);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .health-score-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 0.3; }
        }

        .score-display {
            position: relative;
            z-index: 2;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 8px solid rgba(255,255,255,0.3);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            position: relative;
        }

        .score-excellent { border-color: #38a169; background: rgba(56, 161, 105, 0.2); }
        .score-good { border-color: #d69e2e; background: rgba(214, 158, 46, 0.2); }
        .score-poor { border-color: #e53e3e; background: rgba(229, 62, 62, 0.2); }

        .tabs-container {
            margin: 30px 0;
        }

        .tabs-nav {
            display: flex;
            background: var(--light-gray);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
        }

        .tab-button.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .test-card {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .test-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--success-gradient);
        }

        .test-card.abnormal::before {
            background: var(--warning-gradient);
        }

        .test-card:hover {
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .test-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--dark-color);
            flex: 1;
            min-width: 200px;
        }

        .test-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .status-normal {
            background: linear-gradient(135deg, #68d391, #38a169);
            color: white;
        }

        .status-low, .status-high {
            background: linear-gradient(135deg, #fc8181, #e53e3e);
            color: white;
        }

        .explanation-section {
            background: var(--light-gray);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .explanation-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .recommendation-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--success-color);
        }

        .recommendation-card.avoid {
            border-left-color: var(--danger-color);
        }

        .recommendation-title {
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recommendation-list {
            list-style: none;
        }

        .recommendation-list li {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            position: relative;
            padding-left: 25px;
        }

        .recommendation-list li:last-child {
            border-bottom: none;
        }

        .recommendation-list li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--success-color);
            font-weight: bold;
        }

        .recommendation-card.avoid .recommendation-list li::before {
            content: "✗";
            color: var(--danger-color);
        }

        .condition-card {
            background: linear-gradient(135deg, #fff5f5, #fed7d7);
            border: 2px solid #feb2b2;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .condition-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .condition-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: #c53030;
            flex: 1;
        }

        .confidence-badge {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
            background: #c53030;
            color: white;
        }

        .organ-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .organ-card:hover {
            box-shadow: var(--shadow);
        }

        .organ-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .organ-icon {
            font-size: 3rem;
            margin-right: 20px;
        }

        .organ-info {
            flex: 1;
            min-width: 200px;
        }

        .organ-name {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .organ-description {
            color: var(--text-muted);
            font-size: 1rem;
        }

        .organ-status {
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .status-healthy {
            background: linear-gradient(135deg, #68d391, #38a169);
            color: white;
        }

        .status-attention {
            background: linear-gradient(135deg, #fbb6ce, #ed64a6);
            color: white;
        }

        .status-danger {
            background: linear-gradient(135deg, #fc8181, #e53e3e);
            color: white;
        }

        .health-tips {
            background: var(--info-gradient);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .tips-title {
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tips-list {
            list-style: none;
        }

        .tips-list li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .tips-list li::before {
            content: "💡";
            position: absolute;
            left: 0;
        }

        .error-card {
            background: linear-gradient(135deg, #fff5f5, #fed7d7);
            border: 2px solid #feb2b2;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            color: #c53030;
        }

        .emergency-banner {
            background: linear-gradient(135deg, #fc8181, #e53e3e);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .footer-info {
            text-align: center;
            color: white;
            margin-top: 40px;
            padding: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            .hero-section { padding: 30px 15px; }
            .card-body { padding: 20px; }
            .action-buttons { flex-direction: column; }
            .btn { min-width: auto; }
            .test-header { flex-direction: column; align-items: flex-start; }
            .recommendations-grid { grid-template-columns: 1fr; }
            .tabs-nav { flex-direction: column; }
            .tab-button { min-width: auto; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero-section">
            <h1 class="hero-title">🏥 AI-Powered Medical Report Simplifier</h1>
            <p class="hero-subtitle">
                Transform complex medical reports into simple, easy-to-understand health insights. 
                Get personalized recommendations for your health conditions with foods to eat, avoid, and lifestyle changes.
            </p>
            <div class="sdg-badges">
                <div class="sdg-badge">
                    <div class="sdg-icon sdg-3">3</div>
                    SDG 3: Good Health and Well-being
                </div>
                <div class="sdg-badge">
                    <div class="sdg-icon sdg-10">10</div>
                    SDG 10: Reduced Inequalities
                </div>
            </div>
        </div>

        <div class="main-card">
            <div class="card-header">
                <h2>📋 Submit Your Medical Report</h2>
                <p>Paste your lab results or medical report text below for instant analysis</p>
            </div>
            <div class="card-body">
                <div class="input-section">
                    <label for="medicalReport" class="input-label">
                        🔬 Your Medical Report Text
                    </label>
                    <p class="input-description">
                        Copy and paste your medical report text here. Include test names with values like "Hemoglobin: 12.5 g/dL" or "Blood Sugar: 95 mg/dL"
                    </p>
                    <textarea 
                        id="medicalReport" 
                        class="text-area" 
                        placeholder="Paste your medical report here...

Example:
Complete Blood Count (CBC)
Hemoglobin: 11.2 g/dL
WBC Count: 8500 cells/μL
Glucose: 145 mg/dL
Total Cholesterol: 240 mg/dL
Triglycerides: 185 mg/dL
Creatinine: 1.1 mg/dL
ALT: 35 U/L
TSH: 3.2 mIU/L"
                    ></textarea>
                </div>

                <div class="example-section">
                    <div class="example-title">📝 Example Medical Report Format</div>
                    <div class="example-text">
Complete Blood Count Report
Patient: John Doe | Date: 2024-01-15

Hemoglobin: 11.8 g/dL
White Blood Cells: 12000 cells/μL
Glucose (Fasting): 156 mg/dL
Total Cholesterol: 245 mg/dL
Triglycerides: 220 mg/dL
Creatinine: 1.3 mg/dL
ALT (Liver Enzyme): 68 U/L
TSH: 4.8 mIU/L
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="simplifyReport()">
                        🚀 Simplify My Report
                    </button>
                    <button class="btn btn-secondary" onclick="loadSampleReport()">
                        📝 Load Sample Report
                    </button>
                </div>
            </div>
        </div>

        <div class="loading-overlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <h3>🔬 Analyzing Your Medical Report</h3>
                <p>Processing your test results and generating personalized health recommendations...</p>
            </div>
        </div>

        <div class="results-section">
            <div class="health-score-card">
                <div class="score-display">
                    <div id="healthScoreCircle" class="score-circle">
                        <span id="healthScoreValue">--</span>
                    </div>
                    <h3>Your Health Score</h3>
                    <p id="healthScoreSummary">Overall health assessment based on your medical tests</p>
                </div>
            </div>

            <div class="tabs-container">
                <div class="tabs-nav">
                    <button class="tab-button active" onclick="switchTab('tests')">
                        🧪 Individual Tests
                    </button>
                    <button class="tab-button" onclick="switchTab('conditions')">
                        🏥 Health Conditions
                    </button>
                    <button class="tab-button" onclick="switchTab('organs')">
                        💓 Organ Systems
                    </button>
                    <button class="tab-button" onclick="switchTab('recommendations')">
                        💊 Recommendations
                    </button>
                </div>

                <div id="tests-content" class="tab-content active">
                    <div id="individualTests"></div>
                </div>

                <div id="conditions-content" class="tab-content">
                    <div id="healthConditions"></div>
                </div>

                <div id="organs-content" class="tab-content">
                    <div id="organSystems"></div>
                </div>

                <div id="recommendations-content" class="tab-content">
                    <div id="overallRecommendations"></div>
                </div>
            </div>
        </div>

        <div class="footer-info">
            <h3>🎯 HACKAPHASIA 2025 Project</h3>
           
            <p><strong>⚠️ Medical Disclaimer:</strong> This tool provides educational information only. Always consult healthcare professionals for medical advice.</p>
        </div>
    </div>

    <script>
        // HACKATHON COMPLIANT: Built from scratch JavaScript

        function switchTab(tabName) {
            // Remove active from all tabs and contents
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Add active to selected
            event.target.classList.add('active');
            document.getElementById(tabName + '-content').classList.add('active');
        }

        function showLoading(show) {
            document.querySelector('.loading-overlay').style.display = show ? 'flex' : 'none';
        }

        function showResults(show) {
            document.querySelector('.results-section').style.display = show ? 'block' : 'none';
        }

        function loadSampleReport() {
            const sampleReport = `Complete Blood Count & Metabolic Panel Report
Patient: Sample Patient | Date: ${new Date().toISOString().split('T')[0]}
Lab: HealthCare Laboratory

HEMATOLOGY:
Hemoglobin: 11.2 g/dL
White Blood Cell Count: 12500 cells/μL

CHEMISTRY:
Glucose (Fasting): 156 mg/dL
Creatinine: 1.4 mg/dL

LIPID PROFILE:
Total Cholesterol: 248 mg/dL
Triglycerides: 195 mg/dL

LIVER FUNCTION:
ALT (Alanine Aminotransferase): 72 U/L

THYROID:
TSH (Thyroid Stimulating Hormone): 4.9 mIU/L`;

            document.getElementById('medicalReport').value = sampleReport;
        }

        function displayError(message) {
            showResults(true);
            const testsDiv = document.getElementById('individualTests');
            testsDiv.innerHTML = `
                <div class="error-card">
                    <h3>❌ Analysis Error</h3>
                    <p>${message}</p>
                    <p><strong>Please try:</strong></p>
                    <ul style="text-align: left; margin-top: 15px;">
                        <li>Include test names with values (e.g., "Hemoglobin: 12.5 g/dL")</li>
                        <li>Use the sample report format</li>
                        <li>Make sure test values are clearly formatted</li>
                    </ul>
                </div>
            `;
        }

        function updateHealthScore(score, summary) {
            const scoreCircle = document.getElementById('healthScoreCircle');
            const scoreValue = document.getElementById('healthScoreValue');
            const scoreSummary = document.getElementById('healthScoreSummary');

            scoreValue.textContent = score;
            scoreSummary.textContent = summary;

            // Update circle styling based on score
            scoreCircle.className = 'score-circle';
            if (score >= 80) {
                scoreCircle.classList.add('score-excellent');
            } else if (score >= 60) {
                scoreCircle.classList.add('score-good');
            } else {
                scoreCircle.classList.add('score-poor');
            }
        }

        function displayIndividualTests(tests) {
            const container = document.getElementById('individualTests');

            if (!tests || tests.length === 0) {
                container.innerHTML = `
                    <div class="error-card">
                        <h3>🔍 No Medical Tests Found</h3>
                        <p>We couldn't identify any medical test results in your report.</p>
                        <p>Please make sure to include test names with their values.</p>
                    </div>
                `;
                return;
            }

            const testsHtml = tests.map(test => {
                const statusClass = test.status.toLowerCase();
                const isAbnormal = test.status !== 'NORMAL';

                return `
                    <div class="test-card ${isAbnormal ? 'abnormal' : ''}">
                        <div class="test-header">
                            <div class="test-name">${test.test_name}</div>
                            <div class="test-value">${test.value} ${test.unit}</div>
                            <div class="status-badge status-${statusClass}">
                                ${test.status_emoji} ${test.status}
                            </div>
                        </div>

                        <div class="explanation-section">
                            <div class="explanation-title">
                                🤔 What is this test?
                            </div>
                            <p><strong>${test.simple_explanation.what_it_is}</strong></p>
                            <p style="margin-top: 10px;">${test.simple_explanation.why_important}</p>
                        </div>

                        <div style="margin: 20px 0;">
                            <strong>📊 Reference Range:</strong> ${test.reference_range} ${test.unit}
                        </div>

                        <div style="margin: 20px 0; padding: 15px; background: ${isAbnormal ? '#fff5f5' : '#f0fff4'}; border-radius: 10px;">
                            <strong>${isAbnormal ? '⚠️' : '✅'} What this means for you:</strong>
                            <p style="margin-top: 8px;">${test.interpretation}</p>
                        </div>

                        <div class="recommendations-grid">
                            <div class="recommendation-card">
                                <div class="recommendation-title">
                                    🍎 Foods to Eat
                                </div>
                                <ul class="recommendation-list">
                                    ${test.recommendations.foods_to_eat.map(food => `<li>${food}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="recommendation-card avoid">
                                <div class="recommendation-title">
                                    🚫 Foods to Avoid
                                </div>
                                <ul class="recommendation-list">
                                    ${test.recommendations.foods_to_avoid.map(food => `<li>${food}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="recommendation-card">
                                <div class="recommendation-title">
                                    🏃 Lifestyle Changes
                                </div>
                                <ul class="recommendation-list">
                                    ${test.recommendations.lifestyle.map(lifestyle => `<li>${lifestyle}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="recommendation-card">
                                <div class="recommendation-title">
                                    💪 Physical Activities
                                </div>
                                <ul class="recommendation-list">
                                    ${test.recommendations.activities.map(activity => `<li>${activity}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = testsHtml;
        }

        function displayHealthConditions(conditions) {
            const container = document.getElementById('healthConditions');

            if (!conditions || conditions.length === 0) {
                container.innerHTML = `
                    <div class="test-card">
                        <h3 style="color: #38a169;">✅ Great News!</h3>
                        <p>Based on your test results, no specific health conditions were identified that require immediate attention.</p>
                        <p><strong>Keep up the good work!</strong> Continue maintaining healthy habits and regular check-ups with your healthcare provider.</p>
                    </div>
                `;
                return;
            }

            const conditionsHtml = conditions.map(condition => `
                <div class="condition-card">
                    <div class="condition-header">
                        <div class="condition-name">🏥 ${condition.name}</div>
                        <div class="confidence-badge">${condition.confidence} Confidence</div>
                    </div>

                    <p style="margin-bottom: 20px; font-size: 1.1rem;">
                        <strong>${condition.description}</strong>
                    </p>

                    <div style="margin-bottom: 20px;">
                        <strong>🎯 Severity:</strong> ${condition.severity}
                    </div>

                    <div style="margin-bottom: 20px;">
                        <strong>💊 Treatment Approach:</strong> ${condition.treatment_approach}
                    </div>

                    <div style="background: white; padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <strong>⚠️ Common Symptoms to Watch For:</strong>
                        <ul style="margin-top: 10px; padding-left: 20px;">
                            ${condition.symptoms.map(symptom => `<li>${symptom}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="recommendations-grid" style="margin-top: 20px;">
                        <div class="recommendation-card">
                            <div class="recommendation-title">🍎 Recommended Foods</div>
                            <ul class="recommendation-list">
                                ${condition.recommendations.foods_to_eat.map(food => `<li>${food}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="recommendation-card avoid">
                            <div class="recommendation-title">🚫 Foods to Avoid</div>
                            <ul class="recommendation-list">
                                ${condition.recommendations.foods_to_avoid.map(food => `<li>${food}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="recommendation-card">
                            <div class="recommendation-title">🏃 Lifestyle Changes</div>
                            <ul class="recommendation-list">
                                ${condition.recommendations.lifestyle_changes.map(change => `<li>${change}</li>`).join('')}
                            </ul>
                        </div>
                    </div>

                    <div style="background: #e53e3e; color: white; padding: 15px; border-radius: 10px; margin-top: 20px;">
                        <strong>🏥 When to See a Doctor:</strong>
                        <p style="margin-top: 8px;">${condition.when_to_see_doctor}</p>
                    </div>
                </div>
            `).join('');

            container.innerHTML = conditionsHtml;
        }

        function displayOrganSystems(organData) {
            const container = document.getElementById('organSystems');

            if (!organData || Object.keys(organData).length === 0) {
                container.innerHTML = '<div class="test-card"><p>No organ system analysis available.</p></div>';
                return;
            }

            const organHtml = Object.entries(organData).map(([organKey, data]) => {
                const info = data.info;
                let statusClass = 'healthy';

                if (data.status === 'NEEDS IMMEDIATE ATTENTION') {
                    statusClass = 'danger';
                } else if (data.status === 'NEEDS ATTENTION') {
                    statusClass = 'attention';
                }

                let testsHtml = '';
                if (data.affected_tests.length > 0) {
                    testsHtml += '<div style="margin-top: 20px;"><strong>⚠️ Tests Needing Attention:</strong><br>';
                    testsHtml += data.affected_tests.map(test => 
                        `<span style="background: #fed7d7; color: #c53030; padding: 6px 12px; margin: 4px; border-radius: 15px; display: inline-block; font-size: 0.9rem;">
                            ${test.test_name}: ${test.value} ${test.unit} (${test.status})
                        </span>`
                    ).join(' ');
                    testsHtml += '</div>';
                }

                if (data.normal_tests.length > 0) {
                    testsHtml += '<div style="margin-top: 15px;"><strong>✅ Normal Tests:</strong><br>';
                    testsHtml += data.normal_tests.map(test => 
                        `<span style="background: #c6f6d5; color: #2f855a; padding: 6px 12px; margin: 4px; border-radius: 15px; display: inline-block; font-size: 0.9rem;">
                            ${test.test_name}: ${test.value} ${test.unit}
                        </span>`
                    ).join(' ');
                    testsHtml += '</div>';
                }

                return `
                    <div class="organ-card">
                        <div class="organ-header">
                            <div class="organ-icon">${info.icon}</div>
                            <div class="organ-info">
                                <div class="organ-name">${info.name}</div>
                                <div class="organ-description">${info.description}</div>
                            </div>
                            <div class="organ-status status-${statusClass}">
                                ${data.status}
                            </div>
                        </div>

                        ${testsHtml}

                        <div class="health-tips">
                            <div class="tips-title">
                                🌟 Health Tips for ${info.name}
                            </div>
                            <ul class="tips-list">
                                ${info.health_tips.map(tip => `<li>${tip}</li>`).join('')}
                            </ul>
                        </div>

                        ${info.warning_signs ? `
                            <div style="background: #fed7d7; padding: 15px; border-radius: 10px; margin-top: 20px; color: #c53030;">
                                <strong>⚠️ Warning Signs to Watch For:</strong>
                                <ul style="margin-top: 10px; padding-left: 20px;">
                                    ${info.warning_signs.map(sign => `<li>${sign}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}

                        ${info.emergency_advice ? `
                            <div style="background: #e53e3e; color: white; padding: 15px; border-radius: 10px; margin-top: 15px;">
                                <strong>🚨 Emergency Advice:</strong>
                                <p style="margin-top: 8px;">${info.emergency_advice}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');

            container.innerHTML = organHtml;
        }

        function displayOverallRecommendations(recommendations) {
            const container = document.getElementById('overallRecommendations');

            if (!recommendations) {
                container.innerHTML = '<div class="test-card"><p>No recommendations available.</p></div>';
                return;
            }

            const recommendationsHtml = `
                <div style="margin-bottom: 30px;">
                    <h3 style="text-align: center; margin-bottom: 20px; color: var(--dark-color);">
                        🎯 Your Personalized Health Action Plan
                    </h3>
                    <p style="text-align: center; color: var(--text-muted); margin-bottom: 30px;">
                        Based on your medical test results, here are the most important actions you can take to improve your health.
                    </p>
                </div>

                <div class="recommendations-grid">
                    <div class="recommendation-card">
                        <div class="recommendation-title">
                            🍎 Prioritize These Foods
                        </div>
                        <ul class="recommendation-list">
                            ${recommendations.foods_to_eat.map(food => `<li>${food}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="recommendation-card avoid">
                        <div class="recommendation-title">
                            🚫 Limit or Avoid These
                        </div>
                        <ul class="recommendation-list">
                            ${recommendations.foods_to_avoid.map(food => `<li>${food}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="recommendation-card">
                        <div class="recommendation-title">
                            🏃 Lifestyle Changes
                        </div>
                        <ul class="recommendation-list">
                            ${recommendations.lifestyle.map(change => `<li>${change}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="recommendation-card">
                        <div class="recommendation-title">
                            💪 Physical Activities
                        </div>
                        <ul class="recommendation-list">
                            ${recommendations.activities.map(activity => `<li>${activity}</li>`).join('')}
                        </ul>
                    </div>
                </div>

                <div style="background: var(--info-gradient); color: white; padding: 25px; border-radius: 15px; margin-top: 30px; text-align: center;">
                    <h4 style="margin-bottom: 15px;">💡 Remember</h4>
                    <p>These recommendations are based on your current test results. Always consult with your healthcare provider before making significant changes to your diet, exercise routine, or medications.</p>
                </div>
            `;

            container.innerHTML = recommendationsHtml;
        }

        async function simplifyReport() {
            const reportText = document.getElementById('medicalReport').value.trim();

            if (!reportText) {
                alert('Please enter your medical report text first.');
                return;
            }

            showLoading(true);
            showResults(false);

            try {
                const response = await fetch('/simplify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        medical_text: reportText 
                    })
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'Analysis failed');
                }

                const report = data.report;

                // Show emergency banner if needed
                if (report.urgent_care_needed) {
                    const emergencyBanner = document.createElement('div');
                    emergencyBanner.className = 'emergency-banner';
                    emergencyBanner.innerHTML = `
                        <h3>🚨 URGENT: Some of your test results may require immediate medical attention!</h3>
                        <p>Please contact your healthcare provider or visit an emergency room if you're experiencing symptoms.</p>
                    `;
                    document.querySelector('.results-section').prepend(emergencyBanner);
                }

                // Update health score
                updateHealthScore(report.health_score, report.summary);

                // Display all sections
                displayIndividualTests(report.individual_tests);
                displayHealthConditions(report.health_conditions);
                displayOrganSystems(report.organ_analysis);
                displayOverallRecommendations(report.overall_recommendations);

                showLoading(false);
                showResults(true);

                // Scroll to results
                document.querySelector('.results-section').scrollIntoView({ 
                    behavior: 'smooth' 
                });

            } catch (error) {
                showLoading(false);
                displayError(error.message || 'An error occurred during analysis.');
                console.error('Analysis error:', error);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🏥 Medical Report Simplifier Loaded ');
        });
    </script>
</body>
</html>